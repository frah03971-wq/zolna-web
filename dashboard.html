<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø³Ø§Ø¨ÙŠ - Ø²ÙˆÙ„Ù†Ø§ | Zolna Dashboard</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    
    <style>
        * { font-family: 'Cairo', sans-serif; }
        
        .gradient-bg { 
            background: linear-gradient(135deg, #059669 0%, #047857 50%, #065f46 100%); 
        }
        
        .card-hover { 
            transition: all 0.3s ease; 
        }
        
        .card-hover:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 20px 40px rgba(0,0,0,0.15); 
        }
        
        .bank-card-bankak {
            background: linear-gradient(135deg, #e91e63 0%, #f48fb1 100%);
        }
        
        .bank-card-fawry {
            background: linear-gradient(135deg, #2196f3 0%, #64b5f6 100%);
        }
        
        .bank-card-cash {
            background: linear-gradient(135deg, #ff9800 0%, #ffb74d 100%);
        }
        
        .tab-active {
            border-bottom: 3px solid #059669;
            color: #059669;
            font-weight: bold;
        }
        
        .progress-bar {
            transition: width 0.5s ease;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse-dot {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Firebase Config -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCx9a7vzp5x0PM6_BurDdfXXhjvJwgbx_U",
            authDomain: "zolna-sd.firebaseapp.com",
            projectId: "zolna-sd",
            storageBucket: "zolna-sd.firebasestorage.app",
            messagingSenderId: "1079282652053",
            appId: "1:1079282652053:web:fd8cb84c19aff096b45c9c",
            measurementId: "G-V2KJ0CVRBX"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
    </script>

    <!-- Navigation -->
    <nav class="gradient-bg text-white sticky top-0 z-50 shadow-xl">
        <div class="container mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3 cursor-pointer" onclick="window.location.href='index.html'">
                    <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center">
                        <span class="text-xl font-bold text-emerald-600">Ø²</span>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">Ø­Ø³Ø§Ø¨ÙŠ</h1>
                        <p class="text-xs text-emerald-100">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <button onclick="window.location.href='index.html'" class="bg-emerald-700 hover:bg-emerald-800 px-4 py-2 rounded-full text-sm transition">
                        â† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    </button>
                    <button onclick="logout()" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-full text-sm transition">
                        Ø®Ø±ÙˆØ¬
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-6">
        
        <!-- User Header -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-6 fade-in">
            <div class="flex items-center gap-4">
                <div class="w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center text-3xl">
                    ğŸ‘¤
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-gray-800">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ <span id="userName">Ø²Ø§Ø¦Ø±</span> ğŸ‘‹</h2>
                    <p class="text-gray-500">Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨: <span id="accountNumber" class="font-mono text-emerald-600">-</span></p>
                    <div class="flex items-center gap-2 mt-1">
                        <span class="w-2 h-2 bg-emerald-500 rounded-full pulse-dot"></span>
                        <span class="text-sm text-emerald-600">Ø­Ø³Ø§Ø¨ Ù†Ø´Ø·</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª -->
            <div class="bg-gradient-to-br from-emerald-500 to-emerald-600 text-white p-6 rounded-2xl shadow-lg card-hover">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-emerald-100 text-sm mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</p>
                        <p class="text-3xl font-bold" id="totalSales">0 Ø¬</p>
                    </div>
                    <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-2xl">
                        ğŸ’°
                    </div>
                </div>
                <div class="mt-4 pt-4 border-t border-white/20">
                    <p class="text-sm text-emerald-100">+12% Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
                </div>
            </div>

            <!-- Ø±ØµÙŠØ¯ÙŠ -->
            <div class="bg-gradient-to-br from-amber-500 to-amber-600 text-white p-6 rounded-2xl shadow-lg card-hover relative overflow-hidden">
                <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-10 -mt-10"></div>
                <div class="flex justify-between items-start relative z-10">
                    <div>
                        <p class="text-amber-100 text-sm mb-1">Ø±ØµÙŠØ¯ÙŠ Ø§Ù„Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø³Ø­Ø¨</p>
                        <p class="text-3xl font-bold" id="myEarnings">0 Ø¬</p>
                        <p class="text-xs text-amber-100 mt-1">Ø¨Ø¹Ø¯ Ø®ØµÙ… 2% Ù†Ø³Ø¨Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹</p>
                    </div>
                    <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-2xl">
                        ğŸ’³
                    </div>
                </div>
                <div class="mt-4 pt-4 border-t border-white/20 relative z-10">
                    <button onclick="showWithdrawModal()" class="bg-white text-amber-600 px-4 py-2 rounded-lg text-sm font-bold hover:bg-gray-100 transition w-full">
                        Ø³Ø­Ø¨ Ø§Ù„Ø¢Ù†
                    </button>
                </div>
            </div>

            <!-- Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª -->
            <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white p-6 rounded-2xl shadow-lg card-hover">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-blue-100 text-sm mb-1">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</p>
                        <p class="text-3xl font-bold" id="salesCount">0</p>
                    </div>
                    <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-2xl">
                        ğŸ“¦
                    </div>
                </div>
                <div class="mt-4 pt-4 border-t border-white/20">
                    <p class="text-sm text-blue-100">5 Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</p>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="bg-white rounded-2xl shadow-lg mb-6">
            <div class="flex border-b overflow-x-auto scrollbar-hide">
                <button onclick="switchTab('overview')" id="tab-overview" class="tab-active px-6 py-4 whitespace-nowrap hover:bg-gray-50 transition">
                    ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©
                </button>
                <button onclick="switchTab('products')" id="tab-products" class="px-6 py-4 text-gray-600 whitespace-nowrap hover:bg-gray-50 transition">
                    ğŸ“¦ Ù…Ù†ØªØ¬Ø§ØªÙŠ
                </button>
                <button onclick="switchTab('withdrawals')" id="tab-withdrawals" class="px-6 py-4 text-gray-600 whitespace-nowrap hover:bg-gray-50 transition">
                    ğŸ’¸ Ø³Ø¬Ù„ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª
                </button>
                <button onclick="switchTab('bank')" id="tab-bank" class="px-6 py-4 text-gray-600 whitespace-nowrap hover:bg-gray-50 transition">
                    ğŸ¦ Ø­Ø³Ø§Ø¨Ø§ØªÙŠ Ø§Ù„Ø¨Ù†ÙƒÙŠØ©
                </button>
            </div>

            <!-- Tab Content: Overview -->
            <div id="content-overview" class="p-6 fade-in">
                <!-- Commission Details -->
                <div class="bg-gray-50 rounded-xl p-6 mb-6">
                    <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
                        <span>ğŸ“Š</span>
                        ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©
                    </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                            <span class="text-gray-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</span>
                            <span class="font-bold text-lg" id="detailTotal">0 Ø¬</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-red-50 rounded-lg text-red-700">
                            <span>Ù†Ø³Ø¨Ø© Ø²ÙˆÙ„Ù†Ø§ (2%)</span>
                            <span class="font-bold text-lg" id="detailCommission">0 Ø¬</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-emerald-50 rounded-lg text-emerald-700 border-2 border-emerald-200">
                            <span class="font-bold">ØµØ§ÙÙŠ Ø±Ø¨Ø­Ùƒ</span>
                            <span class="font-bold text-xl" id="detailNet">0 Ø¬</span>
                        </div>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div class="mt-4">
                        <div class="flex justify-between text-sm mb-2">
                            <span>ØªÙ‚Ø¯Ù…Ùƒ Ù†Ø­Ùˆ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø³Ø­Ø¨ (10,000 Ø¬)</span>
                            <span id="progressText">0%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div id="progressBar" class="bg-emerald-500 h-3 rounded-full progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div>
                    <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
                        <span>ğŸ””</span>
                        Ø¢Ø®Ø± Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª
                    </h3>
                    <div id="recentActivity" class="space-y-3">
                        <p class="text-gray-500 text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø´Ø§Ø·Ø§Øª Ø­Ø¯ÙŠØ«Ø©</p>
                    </div>
                </div>
            </div>

            <!-- Tab Content: Products -->
            <div id="content-products" class="p-6 hidden fade-in">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Ù…Ù†ØªØ¬Ø§ØªÙŠ</h3>
                    <button onclick="window.location.href='index.html'" class="bg-emerald-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-emerald-700 transition">
                        + Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬
                    </button>
                </div>
                <div id="myProductsList" class="space-y-3">
                    <p class="text-gray-500 text-center py-8">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</p>
                </div>
            </div>

            <!-- Tab Content: Withdrawals -->
            <div id="content-withdrawals" class="p-6 hidden fade-in">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Ø³Ø¬Ù„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨</h3>
                    <button onclick="showWithdrawModal()" class="bg-amber-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-amber-600 transition">
                        Ø·Ù„Ø¨ Ø³Ø­Ø¨ Ø¬Ø¯ÙŠØ¯
                    </button>
                </div>
                <div id="withdrawHistory" class="space-y-3">
                    <p class="text-gray-500 text-center py-8">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø³Ø­Ø¨</p>
                </div>
            </div>

            <!-- Tab Content: Bank Accounts -->
            <div id="content-bank" class="p-6 hidden fade-in">
                <h3 class="text-lg font-bold mb-4">Ø­Ø³Ø§Ø¨Ø§ØªÙŠ Ø§Ù„Ø¨Ù†ÙƒÙŠØ©</h3>
                
                <!-- Bank Cards -->
                <div class="grid md:grid-cols-3 gap-4 mb-6">
                    <!-- Bankak -->
                    <div class="bank-card-bankak text-white p-5 rounded-xl shadow-lg cursor-pointer hover:scale-105 transition" onclick="showAddBankModal('bankak')">
                        <div class="flex justify-between items-start mb-4">
                            <span class="text-3xl">ğŸ¦</span>
                            <span class="bg-white/20 px-2 py-1 rounded text-xs">+ Ø¥Ø¶Ø§ÙØ©</span>
                        </div>
                        <h4 class="font-bold text-lg">Ø¨Ù†ÙƒÙƒ</h4>
                        <p class="text-sm text-white/80">Bankak</p>
                        <p class="text-xs mt-2 text-white/60" id="bankak-status">ØºÙŠØ± Ù…Ø±Ø¨ÙˆØ·</p>
                    </div>

                    <!-- Fawry -->
                    <div class="bank-card-fawry text-white p-5 rounded-xl shadow-lg cursor-pointer hover:scale-105 transition" onclick="showAddBankModal('fawry')">
                        <div class="flex justify-between items-start mb-4">
                            <span class="text-3xl">ğŸ’³</span>
                            <span class="bg-white/20 px-2 py-1 rounded text-xs">+ Ø¥Ø¶Ø§ÙØ©</span>
                        </div>
                        <h4 class="font-bold text-lg">ÙÙˆØ±ÙŠ</h4>
                        <p class="text-sm text-white/80">Fawry</p>
                        <p class="text-xs mt-2 text-white/60" id="fawry-status">ØºÙŠØ± Ù…Ø±Ø¨ÙˆØ·</p>
                    </div>

                    <!-- Cash -->
                    <div class="bank-card-cash text-white p-5 rounded-xl shadow-lg cursor-pointer hover:scale-105 transition" onclick="showAddBankModal('cash')">
                        <div class="flex justify-between items-start mb-4">
                            <span class="text-3xl">ğŸ’µ</span>
                            <span class="bg-white/20 px-2 py-1 rounded text-xs">+ Ø¥Ø¶Ø§ÙØ©</span>
                        </div>
                        <h4 class="font-bold text-lg">ÙƒØ§Ø´</h4>
                        <p class="text-sm text-white/80">Ø§Ø³ØªÙ„Ø§Ù… ÙŠØ¯ Ø¨ÙŠØ¯</p>
                        <p class="text-xs mt-2 text-white/60" id="cash-status">ØºÙŠØ± Ù…Ø±Ø¨ÙˆØ·</p>
                    </div>
                </div>

                <!-- Saved Accounts -->
                <div id="savedAccounts" class="space-y-3">
                    <p class="text-gray-500 text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div id="withdrawModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto">
            <div class="gradient-bg text-white p-6 rounded-t-2xl flex justify-between items-center">
                <h3 class="text-xl font-bold">ğŸ’¸ Ø·Ù„Ø¨ Ø³Ø­Ø¨</h3>
                <button onclick="closeWithdrawModal()" class="text-white hover:text-gray-200 text-2xl">Ã—</button>
            </div>
            
            <div class="p-6 space-y-4">
                <!-- Balance Info -->
                <div class="bg-amber-50 border-r-4 border-amber-500 p-4 rounded-lg">
                    <p class="text-amber-800 text-sm">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­ Ù„Ù„Ø³Ø­Ø¨</p>
                    <p class="text-2xl font-bold text-amber-600" id="withdrawAvailable">0 Ø¬</p>
                    <p class="text-xs text-amber-600 mt-1">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰: 10,000 Ø¬</p>
                </div>

                <!-- Amount -->
                <div>
                    <label class="block text-gray-700 font-bold mb-2">Ø§Ù„Ù…Ø¨Ù„Øº (Ø¬Ù†ÙŠÙ‡)</label>
                    <input type="number" id="withdrawAmount" min="10000" step="1000"
                           class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 outline-none focus:border-emerald-500 text-xl font-bold text-center" 
                           placeholder="10000">
                </div>

                <!-- Method -->
                <div>
                    <label class="block text-gray-700 font-bold mb-2">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø³Ø­Ø¨</label>
                    <select id="withdrawMethod" onchange="updateWithdrawForm()" 
                            class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 outline-none focus:border-emerald-500">
                        <option value="">Ø§Ø®ØªØ§Ø± Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©</option>
                        <option value="bankak">ğŸ¦ Ø¨Ù†ÙƒÙƒ (Bankak)</option>
                        <option value="fawry">ğŸ’³ ÙÙˆØ±ÙŠ (Fawry)</option>
                        <option value="cash">ğŸ’µ ÙƒØ§Ø´ (Ø§Ø³ØªÙ„Ø§Ù… ÙŠØ¯ Ø¨ÙŠØ¯)</option>
                    </select>
                </div>

                <!-- Account Details (Dynamic) -->
                <div id="accountDetails" class="hidden">
                    <label class="block text-gray-700 font-bold mb-2" id="accountLabel">Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</label>
                    <input type="text" id="withdrawAccount" 
                           class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 outline-none focus:border-emerald-500" 
                           placeholder="">
                </div>

                <!-- Confirm -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <p class="text-sm text-gray-600 mb-2">Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨:</p>
                    <div class="flex justify-between text-sm">
                        <span>Ø§Ù„Ù…Ø¨Ù„Øº:</span>
                        <span class="font-bold" id="confirmAmount">0 Ø¬</span>
                    </div>
                    <div class="flex justify-between text-sm text-red-600">
                        <span>Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„:</span>
                        <span class="font-bold">0 Ø¬</span>
                    </div>
                    <div class="flex justify-between font-bold text-emerald-600 mt-2 pt-2 border-t">
                        <span>Ø§Ù„ØµØ§ÙÙŠ:</span>
                        <span id="confirmNet">0 Ø¬</span>
                    </div>
                </div>

                <button onclick="submitWithdrawal()" id="submitWithdrawBtn"
                        class="w-full gradient-bg text-white py-4 rounded-xl font-bold hover:opacity-90 transition disabled:opacity-50 disabled:cursor-not-allowed">
                    ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨
                </button>
            </div>
        </div>
    </div>

    <!-- Add Bank Modal -->
    <div id="addBankModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-md w-full p-6">
            <h3 class="text-xl font-bold mb-4" id="addBankTitle">Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨</h3>
            
            <div id="bankFormFields" class="space-y-4">
                <!-- Dynamic fields based on bank type -->
            </div>

            <div class="flex gap-3 mt-6">
                <button onclick="saveBankAccount()" class="flex-1 bg-emerald-600 text-white py-3 rounded-lg font-bold hover:bg-emerald-700 transition">
                    Ø­ÙØ¸
                </button>
                <button onclick="closeAddBankModal()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition">
                    Ø¥Ù„ØºØ§Ø¡
                </button>
            </div>
        </div>
    </div>

    <script>
        const COMMISSION_RATE = 0.02;
        const MIN_WITHDRAWAL = 10000;
        
        let currentUser = null;
        let userStats = {
            totalSales: 0,
            totalCommission: 0,
            netEarnings: 0,
            salesCount: 0
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
        });

        function checkAuth() {
            const user = localStorage.getItem('zolna_user');
            if (!user) {
                window.location.href = 'index.html';
                return;
            }
            currentUser = user;
            document.getElementById('userName').textContent = user;
            document.getElementById('accountNumber').textContent = 'ZOL-' + Math.random().toString(36).substr(2, 8).toUpperCase();
            
            loadUserData();
        }

        function loadUserData() {
            calculateStats();
            loadMyProducts();
            loadWithdrawHistory();
            loadSavedBanks();
            loadRecentActivity();
        }

        function calculateStats() {
            const products = JSON.parse(localStorage.getItem('zolna_products') || '[]');
            const myProducts = products.filter(p => p.seller === currentUser);
            
            userStats.totalSales = myProducts.reduce((sum, p) => sum + (p.price || 0), 0);
            userStats.totalCommission = Math.round(userStats.totalSales * COMMISSION_RATE);
            userStats.netEarnings = userStats.totalSales - userStats.totalCommission;
            userStats.salesCount = myProducts.length;

            // Update UI
            document.getElementById('totalSales').textContent = userStats.totalSales.toLocaleString() + ' Ø¬';
            document.getElementById('myEarnings').textContent = userStats.netEarnings.toLocaleString() + ' Ø¬';
            document.getElementById('salesCount').textContent = userStats.salesCount;

            // Details
            document.getElementById('detailTotal').textContent = userStats.totalSales.toLocaleString() + ' Ø¬';
            document.getElementById('detailCommission').textContent = userStats.totalCommission.toLocaleString() + ' Ø¬';
            document.getElementById('detailNet').textContent = userStats.netEarnings.toLocaleString() + ' Ø¬';

            // Progress bar
            const progress = Math.min((userStats.netEarnings / MIN_WITHDRAWAL) * 100, 100);
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = Math.round(progress) + '%';
        }

        function loadMyProducts() {
            const products = JSON.parse(localStorage.getItem('zolna_products') || '[]');
            const myProducts = products.filter(p => p.seller === currentUser);
            const list = document.getElementById('myProductsList');

            if (myProducts.length === 0) {
                list.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <p class="text-4xl mb-2">ğŸ“¦</p>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</p>
                        <button onclick="window.location.href='index.html'" class="mt-4 text-emerald-600 hover:underline">Ø£Ø¶Ù Ù…Ù†ØªØ¬Ùƒ Ø§Ù„Ø£ÙˆÙ„</button>
                    </div>
                `;
                return;
            }

            list.innerHTML = myProducts.map(p => `
                <div class="flex justify-between items-center p-4 border rounded-xl hover:bg-gray-50 transition">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center text-2xl">
                            ${getCategoryIcon(p.category)}
                        </div>
                        <div>
                            <h4 class="font-bold">${p.title}</h4>
                            <p class="text-sm text-gray-500">${p.createdAt || 'Ø­Ø¯ÙŠØ«Ø§Ù‹'}</p>
                        </div>
                    </div>
                    <div class="text-left">
                        <p class="font-bold text-emerald-600">${p.price?.toLocaleString()} Ø¬</p>
                        <p class="text-xs text-gray-500">ØµØ§ÙÙŠ: ${(p.netPrice || p.price * 0.98).toLocaleString()} Ø¬</p>
                    </div>
                </div>
            `).join('');
        }

        function loadWithdrawHistory() {
            const history = JSON.parse(localStorage.getItem('zolna_withdrawals') || '[]')
                .filter(w => w.seller === currentUser);
            
            const container = document.getElementById('withdrawHistory');

            if (history.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <p class="text-4xl mb-2">ğŸ’¸</p>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø³Ø­Ø¨</p>
                    </div>
                `;
                return;
            }

            const statusColors = {
                pending: 'bg-yellow-100 text-yellow-800',
                approved: 'bg-emerald-100 text-emerald-800',
                rejected: 'bg-red-100 text-red-800',
                completed: 'bg-blue-100 text-blue-800'
            };

            const statusText = {
                pending: 'â³ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',
                approved: 'âœ… ØªÙ… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©',
                rejected: 'âŒ Ù…Ø±ÙÙˆØ¶',
                completed: 'ğŸ’° ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„'
            };

            container.innerHTML = history.map(w => `
                <div class="flex justify-between items-center p-4 border rounded-xl hover:bg-gray-50 transition">
                    <div>
                        <p class="font-bold text-lg">${w.amount.toLocaleString()} Ø¬</p>
                        <p class="text-sm text-gray-500">${getMethodName(w.method)} - ${w.date}</p>
                    </div>
                    <span class="px-3 py-1 rounded-full text-sm ${statusColors[w.status]}">
                        ${statusText[w.status]}
                    </span>
                </div>
            `).join('');
        }

        function loadSavedBanks() {
            const banks = JSON.parse(localStorage.getItem('zolna_banks') || '[]')
                .filter(b => b.seller === currentUser);
            
            // Update status
            const hasBankak = banks.some(b => b.type === 'bankak');
            const hasFawry = banks.some(b => b.type === 'fawry');
            const hasCash = banks.some(b => b.type === 'cash');

            document.getElementById('bankak-status').textContent = hasBankak ? 'âœ… Ù…Ø±Ø¨ÙˆØ·' : 'ØºÙŠØ± Ù…Ø±Ø¨ÙˆØ·';
            document.getElementById('fawry-status').textContent = hasFawry ? 'âœ… Ù…Ø±Ø¨ÙˆØ·' : 'ØºÙŠØ± Ù…Ø±Ø¨ÙˆØ·';
            document.getElementById('cash-status').textContent = hasCash ? 'âœ… Ù…Ø±Ø¨ÙˆØ·' : 'ØºÙŠØ± Ù…Ø±Ø¨ÙˆØ·';

            // Show saved accounts
            const container = document.getElementById('savedAccounts');
            if (banks.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©</p>';
                return;
            }

            container.innerHTML = banks.map(b => `
                <div class="flex justify-between items-center p-4 border rounded-xl bg-gray-50">
                    <div class="flex items-center gap-3">
                        <span class="text-2xl">${getMethodIcon(b.type)}</span>
                        <div>
                            <p class="font-bold">${getMethodName(b.type)}</p>
                            <p class="text-sm text-gray-500 font-mono">${maskAccount(b.account)}</p>
                        </div>
                    </div>
                    <button onclick="deleteBank('${b.id}')" class="text-red-500 hover:text-red-700">
                        ğŸ—‘ï¸
                    </button>
                </div>
            `).join('');
        }

        function loadRecentActivity() {
            // Simulate activity
            const activities = [
                { icon: 'ğŸ’°', text: 'ØªÙ… Ø¨ÙŠØ¹ Ù…Ù†ØªØ¬: ØªÙˆÙŠÙˆØªØ§ ÙƒÙˆØ±ÙˆÙ„Ø§', time: 'Ù…Ù†Ø° Ø³Ø§Ø¹Ø©', type: 'sale' },
                { icon: 'ğŸ‘ï¸', text: '100 Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù…Ù†ØªØ¬Ø§ØªÙƒ', time: 'Ù…Ù†Ø° 3 Ø³Ø§Ø¹Ø§Øª', type: 'view' },
                { icon: 'ğŸ’¸', text: 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø³Ø­Ø¨ Ø¨Ù‚ÙŠÙ…Ø© 50,000 Ø¬', time: 'Ø£Ù…Ø³', type: 'withdraw' }
            ];

            document.getElementById('recentActivity').innerHTML = activities.map(a => `
                <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                    <span class="text-2xl">${a.icon}</span>
                    <div class="flex-1">
                        <p class="text-sm">${a.text}</p>
                        <p class="text-xs text-gray-500">${a.time}</p>
                    </div>
                </div>
            `).join('');
        }

        // Tab Switching
        function switchTab(tab) {
            // Hide all contents
            ['overview', 'products', 'withdrawals', 'bank'].forEach(t => {
                document.getElementById('content-' + t).classList.add('hidden');
                document.getElementById('tab-' + t).classList.remove('tab-active');
                document.getElementById('tab-' + t).classList.add('text-gray-600');
            });

            // Show selected
            document.getElementById('content-' + tab).classList.remove('hidden');
            document.getElementById('tab-' + tab).classList.add('tab-active');
            document.getElementById('tab-' + tab).classList.remove('text-gray-600');
        }

        // Withdraw Modal
        function showWithdrawModal() {
            if (userStats.netEarnings < MIN_WITHDRAWAL) {
                alert(`Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø³Ø­Ø¨ Ù‡Ùˆ ${MIN_WITHDRAWAL.toLocaleString()} Ø¬Ù†ÙŠÙ‡\nØ±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ: ${userStats.netEarnings.toLocaleString()} Ø¬Ù†ÙŠÙ‡`);
                return;
            }
            
            document.getElementById('withdrawAvailable').textContent = userStats.netEarnings.toLocaleString() + ' Ø¬';
            document.getElementById('withdrawModal').classList.remove('hidden');
        }

        function closeWithdrawModal() {
            document.getElementById('withdrawModal').classList.add('hidden');
        }

        function updateWithdrawForm() {
            const method = document.getElementById('withdrawMethod').value;
            const detailsDiv = document.getElementById('accountDetails');
            const label = document.getElementById('accountLabel');
            const input = document.getElementById('withdrawAccount');

            if (!method) {
                detailsDiv.classList.add('hidden');
                return;
            }

            detailsDiv.classList.remove('hidden');
            
            const labels = {
                bankak: 'Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙƒ',
                fawry: 'Ø±Ù‚Ù… ÙÙˆØ±ÙŠ',
                cash: 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù„Ù„ØªÙˆØ§ØµÙ„'
            };

            const placeholders = {
                bankak: 'Ù…Ø«Ø§Ù„: 1234567890',
                fawry: 'Ù…Ø«Ø§Ù„: 0912345678',
                cash: 'Ù…Ø«Ø§Ù„: 0912345678'
            };

            label.textContent = labels[method];
            input.placeholder = placeholders[method];
        }

        document.getElementById('withdrawAmount')?.addEventListener('input', updateConfirmAmount);

        function updateConfirmAmount() {
            const amount = parseFloat(document.getElementById('withdrawAmount').value) || 0;
            document.getElementById('confirmAmount').textContent = amount.toLocaleString() + ' Ø¬';
            document.getElementById('confirmNet').textContent = amount.toLocaleString() + ' Ø¬';
        }

        function submitWithdrawal() {
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const method = document.getElementById('withdrawMethod').value;
            const account = document.getElementById('withdrawAccount').value;

            if (!amount || amount < MIN_WITHDRAWAL) {
                alert('Ø§Ù„Ù…Ø¨Ù„Øº ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 10,000 Ø¬Ù†ÙŠÙ‡ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }

            if (amount > userStats.netEarnings) {
                alert('Ø§Ù„Ù…Ø¨Ù„Øº Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­');
                return;
            }

            if (!method || !account) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }

            const request = {
                id: Date.now().toString(),
                seller: currentUser,
                amount: amount,
                method: method,
                account: account,
                status: 'pending',
                date: new Date().toLocaleString('ar-SD'),
                createdAt: new Date()
            };

            // Save
            let withdrawals = JSON.parse(localStorage.getItem('zolna_withdrawals') || '[]');
            withdrawals.unshift(request);
            localStorage.setItem('zolna_withdrawals', JSON.stringify(withdrawals));

            // Update balance (deduct)
            userStats.netEarnings -= amount;
            
            closeWithdrawModal();
            loadWithdrawHistory();
            calculateStats();
            
            alert(`âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨ Ø¨Ù†Ø¬Ø§Ø­!\n\nØ§Ù„Ù…Ø¨Ù„Øº: ${amount.toLocaleString()} Ø¬\nØ§Ù„Ø·Ø±ÙŠÙ‚Ø©: ${getMethodName(method)}\n\nØ³ÙŠØªÙ… Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©.`);
        }

        // Bank Modal
        let currentBankType = '';

        function showAddBankModal(type) {
            currentBankType = type;
            const titles = {
                bankak: 'Ø±Ø¨Ø· Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙƒ',
                fawry: 'Ø±Ø¨Ø· Ø­Ø³Ø§Ø¨ ÙÙˆØ±ÙŠ',
                cash: 'Ø¥Ø¶Ø§ÙØ© Ø±Ù‚Ù… Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø¨Ø§Ù„ÙƒØ§Ø´'
            };

            document.getElementById('addBankTitle').textContent = titles[type];
            
            const fields = {
                bankak: `
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                        <input type="text" id="bankName" class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 outline-none focus:border-emerald-500">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙƒ</label>
                        <input type="text" id="bankAccount" class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 outline-none focus:border-emerald-500" placeholder="1234567890">
                    </div>
                `,
                fawry: `
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                        <input type="text" id="bankName" class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 outline-none focus:border-emerald-500">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">Ø±Ù‚Ù… ÙÙˆØ±ÙŠ</label>
                        <input type="text" id="bankAccount" class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 outline-none focus:border-emerald-500" placeholder="0912345678">
                    </div>
                `,
                cash: `
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                        <input type="text" id="bankName" class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 outline-none focus:border-emerald-500">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                        <input type="text" id="bankAccount" class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 outline-none focus:border-emerald-500" placeholder="0912345678">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
                        <select id="bankCity" class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 outline-none focus:border-emerald-500">
                            <option>Ø§Ù„Ø®Ø±Ø·ÙˆÙ…</option>
                            <option>Ø£Ù… Ø¯Ø±Ù…Ø§Ù†</option>
                            <option>Ø¨Ø­Ø±ÙŠ</option>
                            <option>Ù…Ø¯Ù†ÙŠ</option>
                            <option>Ø¨ÙˆØ±ØªØ³ÙˆØ¯Ø§Ù†</option>
                        </select>
                    </div>
                `
            };

            document.getElementById('bankFormFields').innerHTML = fields[type];
            document.getElementById('addBankModal').classList.remove('hidden');
        }

        function closeAddBankModal() {
            document.getElementById('addBankModal').classList.add('hidden');
        }

        function saveBankAccount() {
            const name = document.getElementById('bankName')?.value;
            const account = document.getElementById('bankAccount')?.value;

            if (!name || !account) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }

            const bank = {
                id: Date.now().toString(),
                seller: currentUser,
                type: currentBankType,
                name: name,
                account: account,
                city: document.getElementById('bankCity')?.value || 'Ø§Ù„Ø®Ø±Ø·ÙˆÙ…'
            };

            let banks = JSON.parse(localStorage.getItem('zolna_banks') || '[]');
            banks.push(bank);
            localStorage.setItem('zolna_banks', JSON.stringify(banks));

            closeAddBankModal();
            loadSavedBanks();
            alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!');
        }

        function deleteBank(id) {
            if (!confirm('ØªØ£ÙƒØ¯ ØªØ¨ÙŠ ØªØ­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ØŸ')) return;
            
            let banks = JSON.parse(localStorage.getItem('zolna_banks') || '[]');
            banks = banks.filter(b => b.id !== id);
            localStorage.setItem('zolna_banks', JSON.stringify(banks));
            
            loadSavedBanks();
        }

        // Helpers
        function getCategoryIcon(cat) {
            const icons = {
                cars: 'ğŸš—', phones: 'ğŸ“±', electronics: 'ğŸ’»',
                furniture: 'ğŸª‘', property: 'ğŸ ', jobs: 'ğŸ’¼', other: 'ğŸ“¦'
            };
            return icons[cat] || 'ğŸ“¦';
        }

        function getMethodName(method) {
            const names = {
                bankak: 'Ø¨Ù†ÙƒÙƒ', fawry: 'ÙÙˆØ±ÙŠ', cash: 'ÙƒØ§Ø´'
            };
            return names[method] || method;
        }

        function getMethodIcon(method) {
            const icons = {
                bankak: 'ğŸ¦', fawry: 'ğŸ’³', cash: 'ğŸ’µ'
            };
            return icons[method] || 'ğŸ’³';
        }

        function maskAccount(account) {
            if (!account) return '';
            if (account.length < 4) return account;
            return '****' + account.slice(-4);
        }

        function logout() {
            if (confirm('ØªØ£ÙƒØ¯ ØªØ¨ÙŠ ØªØ³Ø¬Ù„ Ø®Ø±ÙˆØ¬ØŸ')) {
                localStorage.removeItem('zolna_user');
                window.location.href = 'index.html';
            }
        }
    </script>

</body>
</html>
